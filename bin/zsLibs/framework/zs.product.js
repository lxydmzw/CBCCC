window.zs=window.zs||{},function(t){"use strict";class e{static get keys(){return null==this._keys&&(this._keys={}),this._keys}static cleanProductKey(t){return t.replace(/\s/g,"").replace("（","(").replace("）",")")}static init(t){if(this.scene=zs.utils.getItem(this.firstSceneCache),this.scene||(this.scene=zs.platform.sync.getScene(),this.scene&&zs.utils.setItem(this.firstSceneCache,this.scene)),null!=t){this._defines=t;for(let e in t)e=this.cleanProductKey(e),zs.configs.gameCfg.pure?(this.keys[e]=null,this._defines[e]=null):this.keys[e]=t[e]}}static sync(t){if(!(null==t||t.length<=0||zs.configs.gameCfg.pure)){t.zs_country_white_list&&(this.country=t.zs_country_white_list);for(let e in t)this.registe(e,t[e]);if(zs.configs.gameCfg.debug)zs.network.edit("is_shielded","0").catch(t=>t);else{let t=!1,s=!1,i=!1,n=this.sceneCheck(this.keys[e.switchScene]),c=this.countryCheck(),l=zs.product.get("zs_block_switchs");for(let e in this.keys){if(!this.keys[e])continue;let h=this.blockCheck(e,l);if(!n&&h){this.keys[e]=null,this._defines&&(this._defines[e]=null),t=!0;continue}if(!c&&h){this.keys[e]=null,this._defines&&(this._defines[e]=null);continue}let r=e+"("+this.sceneMark+")",u=this.keys[r];if(this.scene&&u&&u.length>0){let s=this.sceneCheck(u);if(!s){this.keys[e]=s,this._defines&&(this._defines[e]=s),t=!0;continue}}let f=e+"("+this.cityMark+")",a=this.keys[f];if(this.city&&a&&a.length>0){let t=this.cityCheck(a);if(!t){this.keys[e]=t,this._defines&&(this._defines[e]=t),s=!0;continue}}let o=e+"("+this.timeMark+")",y=this.keys[o];if(this.timestamp&&y&&y.length>0){let t=y.split(/[|｜]/),s=1;if(t.length>1){for(let e=0,i=t.length;e<i;e++)if(!this.timeCheck(t[e])){s=0;break}}else s=this.timeCheck(y);s||(this.keys[e]=s,this._defines&&(this._defines[e]=s),i=!0)}}c||zs.network.edit("is_shielded","1").catch(t=>t),t?(console.log("场景值屏蔽生效",this.scene),zs.td.justTrack("场景值屏蔽生效","场景值屏蔽生效",{scene:this.scene})):s?(console.log("地区屏蔽生效",this.city),zs.td.justTrack("地区屏蔽生效","地区屏蔽生效",{city:this.city})):i&&(console.log("时间屏蔽生效",this.timestamp),zs.td.justTrack("时间屏蔽生效","时间屏蔽生效",{timestamp:this.timestamp}))}this.synced=!0}}static blockCheck(t,e){return t&&e&&""!==e?e.replace(/\s/g,"").split(/[|｜]/).indexOf(t)<0?null:1:null}static countryCheck(){return zs.core.userInfo.is_shielded?(zs.td.justTrack("黑名单屏蔽生效","黑名单屏蔽生效"),null):this.country&&this.countryWhiteList&&""!=this.countryWhiteList&&this.countryWhiteList.replace(/\s/g,"").split(/[|｜]/).indexOf(this.country)<0?(zs.td.justTrack("国家屏蔽生效","国家屏蔽生效",{country:this.country}),null):1}static cityCheck(t){return this.city&&t&&""!==t?t.replace(/\s/g,"").split(/[|｜]/).indexOf(this.city)<0?1:null:1}static sceneCheck(t){return this.scene&&t&&""!==t?t.replace(/\s/g,"").split(/[|｜]/).indexOf(this.scene)<0?1:null:1}static timeCheck(t){if(!this.timestamp||!t||""===t)return 1;let e=t.split("-");if(e.length<2)return 1;let s=e[0].split(/[:：]/),i=e[1].split(/[:：]/),n=new Date(this.timestamp),c=n.getHours(),l=n.getMinutes();if(s.length>0){let t=parseInt(s[0]);if(isNaN(t)&&(t=0),c<t)return 1;if(c==t&&s.length>1){let t=parseInt(s[1]);if(isNaN(t)&&(t=0),l<t)return 1}}if(i.length>0){let t=parseInt(i[0]);if(isNaN(t)&&(t=0),c>t)return 1;if(c==t&&i.length>1){let t=parseInt(i[1]);if(isNaN(t)&&(t=0),l>t)return 1}}return null}static registe(t,e){if(null==e)return;t=this.cleanProductKey(t);let s=this.keys[t];if(null==s||typeof s==typeof e)this.keys[t]=e,this._defines&&(this._defines[t]=e);else if("number"==typeof s&&"string"==typeof e){let s=parseFloat(e);isNaN(s)&&(s=0),this.keys[t]=s,this._defines&&(this._defines[t]=s)}else zs.log.warn("关键词类型不匹配，无法注册产品关键词："+t,"Product")}static get(t){t=this.cleanProductKey(t);let e=this.keys[t];return"function"==typeof e?e.call(this):(null==e&&zs.log.debug("产品开关 "+t+" 不存在"),e)}}e.synced=!1,e.scene=null,e.city=null,e.country=null,e.timestamp=null,e.firstSceneCache="first_enter_scene",e.switchScene="zs_scene_value",e.sceneMark="scene",e.cityMark="city",e.timeMark="time",e.countryWhiteList="中国",t.product=e}(window.zs=window.zs||{});