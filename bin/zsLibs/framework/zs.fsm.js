window.zs=window.zs||{},function(t){"use strict";(window.zs=window.zs||{}).fsm=class{get list(){return null==this._list&&(this._list={}),this._list}init(t,i){this.current=t||this.defaultState,this.target=null,this.current&&(this.onChanged&&this.onChanged.runWith(this.current),(i||this.defaultAuto)&&this.runNext())}getState(t,i){return null==this.list[t]?null:this.list[t][i]}registe(t,i,n,e,r,s,l,h){if(null==this.list[t]&&(this.list[t]={}),e)for(let i in this.list[t])this.list[t][i].auto=null;return null==r&&(r=this),s||(s=(t=>{t.run()})),this.list[t][i]={priority:n||0,thisObj:r,transition:s,condition:l,auto:e,canBreak:h},this}setDefault(t,i){return this.defaultState=t,this.defaultAuto=i,this}unregiste(t,i){return null!=this.list[t]&&null!=this.list[t][i]&&delete this.list[t][i],this}runTransition(t){if(null==this.current||this.current.length<=0)return!1;let i=this.list[this.current];if(null==i)return!1;if(null!=this.target&&null!=i){let t=i[this.target];if(null!=t&&!t.canBreak)return!1}let n=i[t];return!(null==n||null==n.thisObj||n.condition&&!n.condition.call(n.thisObj)||(this.target=t,zs.log.debug("runTransition: "+this.current+" - "+this.target),this.onBeforeChange&&this.onBeforeChange.runWith([this.target,this.current]),n.transition.call(n.thisObj,zs.Handler.create(this,this.onTransitionComplete)),0))}runNext(){if(null==this.current||this.current.length<=0)return null;let t=this.list[this.current];if(null==t)return null;if(null!=this.target&&null!=t){let i=t[this.target];if(null!=i&&!i.canBreak)return null}let i=[],n=[];for(let e in t){let r=t[e],s=!1;for(let t=0,l=n.length;t<l;t++)if(r.priority>n[t].priority){i.splice(t,0,e),n.splice(t,0,r),s=!0;break}s||(i.push(e),n.push(r))}for(let t=0,e=i.length;t<e;t++){let e=n[t];if(null!=e.thisObj&&(!e.condition||e.condition.call(e.thisObj)))return this.target=i[t],zs.log.debug("runNext: "+this.current+" - "+this.target),this.onBeforeChange&&this.onBeforeChange.runWith([this.target,this.current]),e.transition.call(e.thisObj,zs.Handler.create(this,this.onTransitionComplete)),i[t]}return null}onTransitionComplete(){this.current=this.target,this.target=null;let t=this.list[this.current];if(null!=t)for(let i in t)if(t[i].auto){this.runTransition(i);break}this.onChanged&&this.onChanged.runWith(this.current)}}}();