window.platform = function () { function platform() { } return platform.systemInfo = null, platform.init = function () { console.log("platform.init"), platform.systemInfo = qg.getSystemInfoSync(), platform.systemInfo.platformVersionCode < 1051 && (console.error("版本低于1051 需要手动开启初始化"), qg.initAdService({ appId: zs.core.appId, isDebug: !1, success: function (e) { console.log("success") }, fail: function (e) { console.log("fail:" + e.code + e.msg) }, complete: function (e) { console.log("complete") } })) }, platform.initAds = function () { zs.platform.sync.initBanner(), zs.platform.sync.initVideo({ id: zs.product.get("zs_video_adunit") }); let e = []; zs.product.get("zs_native_adunit") && e.push(zs.product.get("zs_native_adunit")), zs.product.get("zs_native_adunit2") && e.push(zs.product.get("zs_native_adunit2")); for (let o = 3; o <= 10; o++)zs.product.get("zs_native_adunit" + o) && e.push(zs.product.get("zs_native_adunit" + o)); zs.platform.sync.initNativeAd({ adUnitIdArr: e, preload: !1, reportShowFunc: platform.sendReqAdShowReport, reportClickFunc: platform.sendReqAdClickReport }); var o = zs.product.get("zs_start_exposure_num"); if (o > 0) for (let e = 0; e < o; e++)platform.addFakeReportNativeAdShow(e) }, platform.login = function () { return new Promise((e, o) => { qg.login({ success: o => { e(o) }, fail: e => { o(e) }, complete: e => { } }) }) }, platform.getLoginParams = function () { return new Promise((e, o) => { qg.login({ success: o => { e({ code: o.data.token }) }, fail: o => { e({ uid: 1 }) }, complete: e => { } }) }) }, platform.setCloudStorage = function (e) { return new Promise((e, o) => { }) }, platform.getCloudStorage = function (e) { return new Promise((e, o) => { }) }, platform.loadSubpackage = function (e) { return new Promise((o, t) => { if (null == e.pkgName) return zs.log.warn("方法（ loadSubpackage ）缺少必要参数（ pkgName ）", "Platform"), t(); let r = qg.loadSubpackage({ name: e.pkgName, success: e => { o(e) }, fail: o => { console.error("分包加载失败分包名字 --\x3e> ", e.pkgName), t(o) } }); r ? e.progressHandler && r.onProgressUpdate(e => { progressHandler.runWith(e.progress) }) : t() }) }, platform.createVideoAdNum = 0, platform.videoReady = !1, platform.videoRequirePlay = !1, platform.initVideo = function (e) { if (null == e.id || e.id.length <= 0) return zs.log.warn("方法（ initVideo ）缺少必要参数（ id ）", "Platform"), void (platform.videoAd = null); if (platform.videoId = e.id, platform.videoAd = qg.createRewardedVideoAd({ adUnitId: e.id }), null == platform.videoAd) { if (platform.createVideoAdNum > 3) return; zs.log.warn("初始化视频失败，重新初始化:" + platform.createVideoAdNum), platform.initVideo(e) } platform.videoReady = !1, platform.videoRequirePlay = !1, platform.videoAd.load(), platform.videoAd.onLoad(function () { zs.log.warn("激励视频加载成功"), platform.videoReady = !0, platform.videoRequirePlay && (platform.videoAd.show(), platform.videoRequirePlay = !1) }), platform.videoAd && (platform.videoAd.onError(platform.onVideoErrorHandler), platform.videoAd.onClose(platform.onVideoCloseHandler)) }, platform.playVideo = function () { return new Promise((e, o) => { if (null == platform.videoAd) return o(null); platform.videoCloseHandler = (o => { e(o) }), platform.videoErrorHandler = (e => { o(e) }), platform.videoReady ? platform.videoAd.show() : platform.videoRequirePlay = !0 }) }, platform.isVideoEnable = function () { return null != platform.videoAd }, platform.onVideoErrorHandler = function (e) { platform.videoErrorHandler && platform.videoErrorHandler(e) }, platform.onVideoCloseHandler = function (e) { platform.videoReady = !1, platform.videoAd.load(), e && e.isEnded || null == e ? (console.log("激励视频广告完成，发放奖励:" + Date.now()), platform.videoCloseHandler && platform.videoCloseHandler(!0)) : (console.log("激励视频广告完成，发放奖励:" + Date.now()), platform.videoCloseHandler && platform.videoCloseHandler(!1)) }, platform.insertId = null, platform.initInsert = function (e) { }, platform.loadInsert = function (e) { }, platform.createBannerNum = 0, platform.bannerErrorHandler = null, platform.bannerAd = null, platform.createBanner = function (e) { if (null == e.id || e.id.length <= 0) return void zs.log.warn("方法（ initBanner ）缺少必要参数（ id ）", "Platform"); if (e && e.onError && (platform.bannerErrorHandler = e.onError), console.log("初始化banner:" + e.id), platform.bannerId = e.id, platform.createBannerNum += 1, platform.systemInfo.platformVersionCode >= 1051) { if (platform.bannerAd = qg.createBannerAd({ adUnitId: platform.bannerId }), null == platform.bannerAd) { if (console.log("banner create fail"), platform.createBannerNum > 3) return; platform.initBannerAD(platform.bannerId, { id: e.id, onError: platform.bannerErrorHandler }) } console.log("banner create success"), platform.bannerAd.onError(function (e) { console.error("bannerAd error:", e), platform.bannerErrorHandler && platform.bannerErrorHandler.run(), platform.bannerAd || console.warn("bannerAd lose") }) } }, platform.initBanner = function () { let e = zs.product.get("zs_onemin_show_ad_switch"), o = zs.product.get("zs_show_banner_time"); e ? (platform.setIsInOneMin(!0), Laya.timer.once(6e4, this, () => { platform.setIsInOneMin(!1), platform.createBanner({ id: zs.product.get("zs_banner_adunit") }) })) : o > 0 ? Laya.timer.once(o, this, () => { platform.createBanner({ id: zs.product.get("zs_banner_adunit") }) }) : platform.createBanner({ id: zs.product.get("zs_banner_adunit") }), platform.initGamePortalAd(zs.product.get("zs_gamePortalAd_id")) }, platform.showBanner = function (e) { if (e && null != e.onError || zs.log.warn("方法（ showBanner ）缺少必要参数（ onError ）", "Platform"), platform.isInOneMin) zs.log.debug("后台开关打开一分钟内不展示广告"); else if (null != platform.bannerId) { if (null == platform.bannerAd) { let o = null; e && e.onError && (o = e.onError), platform.initBanner({ id: platform.bannerId, onError: o }) } zs.log.debug("bannerAd show"), platform.bannerAd.show() } }, platform.hideBanner = function () { zs.log.debug('bannerAd hide"'), platform.bannerAd && platform.bannerAd.hide() }, platform.delayBanner = null, platform.checkBanner = function (e) { if (null == e.data) return void zs.log.warn("方法（ checkBanner ）缺少必要参数（ data ）", "Platform"); let o = e.data; if (o) { let e = o.banner; e && (e.isDelay ? (zs.log.debug("延时 banner"), platform.delayBanner = setTimeout(function () { platform.showBanner() })) : e.lockHide ? platform.hideBanner() : platform.showBanner()) } else platform.hideBanner() }, platform.clearDelayBanner = function () { zs.log.debug("清除延时 banner"), platform.delayBanner && clearTimeout(platform.delayBanner), platform.delayBanner = null }, platform.initNativeAd = function (e = {}) { zs.nativeData.NativeManager.Instance.initNativeData(e.adUnitIdArr, e.preload, e.reportShowFunc, e.reportClickFunc) }, platform.loadNativeAd = function () { return new Promise((e, o) => { zs.nativeData.NativeManager.Instance.getNativeData(o => { e(o) }, e => { o(e) }) }) }, platform.addFakeReportNativeAdShow = function (e = 0) { setTimeout(() => { platform.loadNativeAd().then(() => { console.log("开局 增加一次无效曝光 ----- loadNativeAd ---- then") }).catch(e => { console.log("开局 增加一次无效原生曝光 ----- loadNativeAd ---- catch", e) }) }, 1e3 + 6e3 * e) }, platform.reportNativeAdShow = function (e) { }, platform.reportNativeAdClick = function (e, o) { zs.nativeData.NativeManager.Instance.reportNativeAdClick(e, o), console.log("report OPPO NativeAd Click:" + Date.now()) }, platform.hasDesktopIcon = function () { return new Promise((e, o) => { qg.hasShortcutInstalled({ success: function (o) { e(o) }, fail: function (e) { console.log("request desktop icon error:" + JSON.stringify(e)), o("request desktop icon error:" + JSON.stringify(e)) } }) }) }, platform.createDesktopIcon = function () { return new Promise((e, o) => { qg.installShortcut({ success: function (o) { console.log("create DesktopIcon success:", o), e() }, fail: function (e) { console.log("create desktop icon fail", e), o() }, complete: function () { console.log("create desktop icon complete") } }) }) }, platform.gamePortalAdId = null, platform.gamePortalAd = null, platform.gamePortalAdShowTime = 0, platform.gamePortalAdError = null, platform.initGamePortalAd = function (e) { null != e && "" != e ? (platform.gamePortalAdId = e, qg.getSystemInfoSync().platformVersionCode >= 1076 ? (console.log("初始化互推盒子"), platform.gamePortalAd = qg.createGamePortalAd({ adUnitId: e }), platform.gamePortalAd.onError(function (e) { console.log("互推盒子九宫格广告出错", JSON.stringify(e)), platform.gamePortalAdError && platform.gamePortalAdError() })) : console.log("快应用平台版本号低于1076，暂不支持互推盒子相关 API")) : console.log("互推盒子九宫格广告id为空") }, platform.showGamePortalAd = function () { return new Promise((e, o) => { platform.gamePortalAd ? (platform.gamePortalAdError = (() => { o() }), platform.gamePortalAd.onLoad(function () { console.log("互推盒子九宫格广告加载成功"), platform.gamePortalAd.show().then(function () { console.log("显示互推盒子九宫格广告成功"), platform.gamePortalAdShowTime = Date.now(), e() }).catch(function (e) { console.log("显示互推盒子九宫格广告fail:" + e.errCode + "," + e.errMsg), o() }) }), platform.gamePortalAd.load()) : o() }) }, platform.statusBarHeight = function () { return platform.systemInfo ? platform.systemInfo.statusBarHeight : 0 }, platform.screenWidth = function () { return platform.systemInfo ? platform.systemInfo.screenWidth : 1 }, platform.screenHeight = function () { return platform.systemInfo ? platform.systemInfo.screenHeight : 1 }, platform.vibrate = function (e) { e && e.isLong ? qg.vibrateLong({ fail: () => { zs.log.debug("Vibrate Long failed") } }) : qg.vibrateShort({ fail: () => { zs.log.debug("vibrate Short failed") } }) }, platform.isNetValid = function () { return !0 }, platform.addEventShow = function (e) { qg.onShow(o => { e.showHandler && e.showHandler(o) }) }, platform.addEventHide = function (e) { qg.onHide(o => { e.hideHandler && e.hideHandler(o) }) }, platform.zs_ad_report_status = {}, platform.zs_native_lsat_showTime = 0, platform.isInOneMin = !1, platform.setIsInOneMin = function (e) { platform.isInOneMin = e }, platform.getIsInOneMin = function () { return platform.isInOneMin }, platform.sendReqAdShowReport = function (e) { e ? platform.requestNativeAdReport({ adunit: e, type: "display" }).then(e => { var o = "0" == e.ad_status; console.log("原生广告上报返回id:" + e.adunit + " adStatus:" + o), platform.zs_ad_report_status[e.adunit] = o }) : console.error("return unitId is null") }, platform.sendReqAdClickReport = function (e) { return e ? null == platform.zs_ad_report_status[e] || platform.zs_ad_report_status[e] ? (platform.requestNativeAdReport({ adunit: e, type: "click" }).then(e => { var o = "0" == e.ad_status; console.log("原生广告上报返回id:" + e.adunit + " adStatus:" + o), platform.zs_ad_report_status[e.adunit] = o }), !0) : (console.log("受到了点击控制,不上报点击"), !1) : (console.error("return unitId is null"), !1) }, platform.requestNativeAdReport = function (e) { return new Promise((o, t) => { if (e.adunit && e.type) { zs.network.nativeRequest("https://platform.qwpo2018.com/api/ad_cache/index", e, "POST", !0).then(t => { console.error("result -----\x3e>> ", e, t), o(t) }).catch(e => { console.warn("请求原生 上报失败", e) }) } else console.error("request report ad click error!") }) }, platform.getAdReporteStatus = function (e) { return new Promise((o, t) => { console.warn("广告id:" + e + " 是否显示广告：" + platform.zs_ad_report_status[e]), null == platform.zs_ad_report_status[e] || platform.zs_ad_report_status[e] ? o() : t() }) }, platform.getGameNum = function () { let e = zs.product.get("zs_native_adunit"); var o = Laya.LocalStorage.getItem(e + "game_num_time_stamp"); if (null == o || "" == o || 0 == platform.isToday(Number(o))) return Laya.LocalStorage.setItem(e + "game_num", "1"), 1; var t = Laya.LocalStorage.getItem(e + "game_num"); return null == t || "" == t ? 1 : Number(t) }, platform.updateReviveTypeInfo = function (e) { Laya.LocalStorage.setItem(e + "_time_stamp", Date.now().toString()); var o = Laya.LocalStorage.getItem(e), t = null == o || "" == o ? 0 : Number(o); t++, Laya.LocalStorage.setItem(e, t.toString()) }, platform.setNativeLastShowTime = function (e) { platform.zs_native_lsat_showTime = e }, platform.isOppoShowAd = function () { var e = !0; let o = zs.product.get("zs_native_limit_10"); if (o) { var t = Laya.Browser.now() - platform.zs_native_lsat_showTime; e = t >= 1e4 } return console.log("========== zs_native_limit_10:" + o + "      gapTime:" + t), e }, platform.isBeforeGameAccount = function () { return new Promise((e, o) => { var t = platform.getGameNum(); console.log(t, platform.isOppoShowAd(), "一分钟不展示广告", platform.isInOneMin), !platform.isInOneMin && platform.isShowNativeAd(t) && platform.isOppoShowAd() && zs.product.get("zs_version") ? e() : o() }) }, platform.isShowNativeAd = function (e) { let o = zs.product.get("zs_native_end_before_num"), t = zs.product.get("zs_native_adunit"); if (platform.IsNumber(o)) { if (-1 == o) return !0; var r = platform.getNativeOpenNum(); if (console.log("----原生广告打开次数：" + r), Number(o) > Number(r)) return !0 } if (o && o.length > 0) { var a = o.slice(1, o.length - 1).split(","); if (1 == a.length && -1 == a[0]) return !0; if (-1 != a.indexOf(e + "")) return console.log("----游戏次数：" + e), !0; platform.updateReviveTypeInfo(t + "game_num") } return !1 }, platform.getNativeOpenNum = function () { let e = zs.product.get("zs_native_adunit"); var o = Laya.LocalStorage.getItem(e + "open_native_num_time_stamp"); if (null == o || "" == o || 0 == platform.isToday(Number(o))) return Laya.LocalStorage.setItem(e + "open_native_num", "0"), 0; var t = Laya.LocalStorage.getItem(e + "open_native_num"); return null == t || "" == t ? 0 : Number(t) }, platform.IsNumber = function (e) { return !(!/^\d+(\.\d+)?$/.test(e) && !/^(-(([0-9]+\.[0-9]*[1-9][0-9]*)|([0-9]*[1-9][0-9]*\.[0-9]+)|([0-9]*[1-9][0-9]*)))$/.test(e)) }, platform.isToday = function (e) { var o = new Date(Date.now()), t = new Date(e); return o.getFullYear() == t.getFullYear() && o.getMonth() == t.getMonth() && o.getDate() == t.getDate() }, platform.showToast = function (e, o = 2e3) { qg.showToast({ title: e, icon: "none", duration: o }) }, platform }();